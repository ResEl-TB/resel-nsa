.TH nsafs 5 "23 février 2024" "ResEl NSA" "ResEl NSA user manual"
.SH NOM
NSAfs \- Système de fichiers de ResEl NSA
.SH DESCRIPTION
.B NSAfs
est un système de fichiers en espace utilisateur utilisant l’API FUSE. Il se
charge de collecter des métriques envoyées par des agents externes et de
séquencer leur envoi à un serveur Warp 10 distant. Par défaut, NSAfs est monté
dans \fI/var/spool/nsa\fR (que nous appelons dans la suite la « spoule »).

.SS Arborescence
La spoule est structurée
sous forme d’une arborescence infinie. Les éléments commençant par une arobase
(\fI@\fR) désignent des fichiers, et les autres désignent des dossiers (avec
quelques exceptions à la racine). Les dossiers listés par
.B NSAfs
correspondent aux profils définis dans la configuration. Si la configuration
mentionne \fB[profil1.profil2.profil3]\fR,
.B NSAfs
connaîtra les dossiers \fIprofil1\fR,
.I profil1/profil2
et \fIprofil1/profil2/profil3\fR. Même s’ils ne sont pas connus par NSAfs, tous
les dossiers existent ; peu importe la configuration du système, les dossiers
.I foo/bar/baz
ou encore
.I toto/tutu
existent.

NSAfs connaît deux fichiers spéciaux pour chaque dossier :
.I @
et \fI@now\fR. Le premier est un lien symbolique vers un fichier correspondant
à la politique d’envoi du profil. Par exemple, si la politique est
\fB"1m30s"\fR,
.I @
pointera sur \fI@1m30s\fR. Le second est un fichier pouvant accueillir des
données à envoyer au plus vite. Il est possible d’écrire dans ces fichiers
(en mode « ajout ») pour y envoyer des métriques selon la politique
correspondante. Tout comme pour les dossiers, ce n’est pas parce que
.B NSAfs
ne connaît pas un fichier que celui-ci n’existe pas. Ainsi, si l’on souhaite
envoyer des données avec la politique \fB"10m"\fR non listée, il suffit
d’écrire dans \fB@10m\fR.

Enfin, il y a quatre fichiers spéciaux à la racine de la spoule :
.RS 4m
.TP 16m
.I ??gc
L’écriture de données dans ce fichier lance le ramasse-miettes d’OCaml sur le
système de fichiers. Si vous ne comprenez pas cette phrase et ses implications,
n’utilisez pas ce fichier.
.TP
.I ??inspect
La lecture de ce fichier donne l’ensemble des données présentes dans la spoule.
.TP
.I ??memstats
La lecture de ce fichier donne des statistiques sur l’utilisation mémoire du
système de fichiers.
.TP
.I ??reload
L’écriture de données dans ce fichier lance le rechargement de la configuration
de \fBNSAfs\fR.
.RE
.SH VOIR AUSSI
.BR nsa.conf (5),
.BR resel-nsa (7),
.BR nsa (8)
